<!DOCTYPE html>
<html>
<head>
    <title>BLE Device Controller</title>
</head>
<body>
    <h1>Control Panel for BLE Device</h1>
    <input type="text" id="armsTrigger" placeholder="Enter Arms Extension">
    <button onclick="sendInitCommand('AT')">Move Amrs</button>

    <input type="text" id="torsoTrigger" placeholder="Enter Torso Extension">
    <button onclick="sendInitCommand('TT')">Move Amrs</button>

    <button onclick="sendInitCommand('ZT')">Trigger Taser</button>
    <p id="status">Status: Disconnected</p>

    <script>
        let bleDevice = null;
        let writeCharacteristic = null;

        async function connectToDevice() {
            try {
                const serviceUuid = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
                const characteristicUuid = "6e400003-b5a3-f393-e0a9-e50e24dcca9e";
                
                console.log('Requesting Bluetooth Device...');
                bleDevice = await navigator.bluetooth.requestDevice({
    filters: [{
        name: "SOAR_SentryTurret"
    }],
    optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
    });
                
                console.log('Connecting to GATT Server...');
                const server = await bleDevice.gatt.connect();
                
                console.log('Getting Service...');
                const service = await server.getPrimaryService(serviceUuid);
                
                console.log('Getting Characteristic...');
                writeCharacteristic = await service.getCharacteristic(characteristicUuid);

                document.getElementById('status').textContent = "Status: Connected";
            } catch (error) {
                console.error('Connection failed!', error);
                document.getElementById('status').textContent = `Status: ${error}`;
            }
        }

        async function sendCommand(command) {
            if (!writeCharacteristic) {
                await connectToDevice();
            }
            if (writeCharacteristic) {
                console.log(`Sending command: ${command}`);
                let encoder = new TextEncoder('utf-8');
                await writeCharacteristic.writeValue(encoder.encode(command));
            }
        }

        async function sendInitCommand(type) {
            if (type==='ZT') {
                await sendCommand('ZT');
            }else{
                const numberInput = document.getElementById('numberInput').value;
                if (!isNaN(numberInput) && numberInput.trim() !== '') {
                    if (type==='AT') {
                        const atCommand = `AT:${numberInput}`;
                        await sendCommand(atCommand);
                    } else if (type==='TT') {
                        const ttCommand = `TT:${numberInput}`;
                        await sendCommand(ttCommand);
                    }
                } else {
                    console.error('Invalid number input!');
                }
            }  
        }
    </script>
</body>
</html>
